# Remix (Vite) for Cloudflare Pages + Cloudflare D1 + Drizzle ORM

It works at Cloudflare Pages.

[https://remix-cloudflare-pages-d1-34w.pages.dev/]

Stacks

- [Remix](https://remix.run/)
- [Vite](https://vitejs.dev/)
- [Cloudflare Pages](https://pages.cloudflare.com/)
- [Tailwind CSS](https://tailwindcss.com/)
- [Drizzle ORM](https://orm.drizzle.team/)

## Initial Setup

This project requires `wrangler.toml` for Cloudflare bindings.

```sh
mv wrangler.toml.sample wrangler.toml
```

Database setup of Cloudflare D1.

```sh
pnpm db:create
```

Local database migration with SQL file generated by Drizzle ORM.

```sh
pnpm db:init:local
```

## Development

Run the Vite dev server:

```sh
pnpm run dev
```

To run Wrangler:

```sh
pnpm run build
pnpm run start
```

## Typegen

Generate types for your Cloudflare bindings in `wrangler.toml`:

```sh
pnpm run typegen
```

You will need to rerun typegen whenever you make changes to `wrangler.toml`.

## Deployment

If you did not create database `dev-remix-d1`, run this command.

```sh
pnpm db:create
```

Remote database migration with SQL file generated by Drizzle ORM.

```sh
pnpm db:init:remote
```

First, build your app for production:

```sh
pnpm run build
```

Then, deploy your app to Cloudflare Pages:

```sh
pnpm run deploy
```

## ORM

When you edited `app/lib/schema.ts`, generate SQL file for generate this command.

```sh
pnpm db:generate
```

and fix SQL path.

```diff
-    "db:init:local": "wrangler d1 execute dev-remix-d1 --local --file=./drizzle/0000_demonic_chameleon.sql",
+    "db:init:local": "wrangler d1 execute dev-remix-d1 --local --file=./drizzle/<YOUR_GENERATED_SQL_PATH>",
```

Update datable.

```sh
pnpm db:reset:local
pnpm db:init:local
```

## Notes

Configuration via `wrangler.toml` is in open beta.

[Configuration via wrangler.toml](https://developers.cloudflare.com/pages/functions/wrangler-configuration/)

## License

MIT
